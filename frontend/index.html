<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Analytics Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: #f9f9f9;
            color: #0f0f0f;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* í—¤ë” */
        .header {
            background: linear-gradient(135deg, #282828, #212121);
            color: white;
            padding: 30px;
            border-radius: 16px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .header p {
            opacity: 0.9;
            font-size: 15px;
        }

        /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */
        .tabs {
            display: flex;
            background: white;
            border-radius: 12px;
            padding: 8px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            flex-wrap: wrap;
            gap: 4px;
        }

        .tab {
            padding: 12px 24px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #666;
            border-radius: 8px;
            transition: all 0.2s;
            font-family: inherit;
        }

        .tab:hover {
            background: #f0f0f0;
        }

        .tab.active {
            background: #FF0000;
            color: white;
        }

        /* ì¹´ë“œ */
        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: #282828;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* ì…ë ¥ í•„ë“œ */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: #555;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #FF0000;
        }

        /* ë²„íŠ¼ */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .btn-primary {
            background: #FF0000;
            color: white;
        }

        .btn-primary:hover {
            background: #cc0000;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn-success {
            background: #34a853;
            color: white;
        }

        .btn-danger {
            background: #ea4335;
            color: white;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* í†µê³„ ê·¸ë¦¬ë“œ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .stat-card .icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .stat-card .value {
            font-size: 24px;
            font-weight: 700;
            color: #FF0000;
        }

        .stat-card .label {
            font-size: 13px;
            color: #666;
            margin-top: 4px;
        }

        /* ë¶„ë¥˜ ë°°ì§€ */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-viral { background: #ffebee; color: #c62828; }
        .badge-hit { background: #fff3e0; color: #e65100; }
        .badge-average { background: #e3f2fd; color: #1565c0; }
        .badge-underperform { background: #f5f5f5; color: #616161; }

        /* í…Œì´ë¸” */
        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background: #f5f5f5;
            font-weight: 600;
            font-size: 13px;
            color: #555;
        }

        tr:hover {
            background: #f9f9f9;
        }

        /* íƒ­ ì»¨í…ì¸  */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ë¡œë”© */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #FF0000;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ì•Œë¦¼ */
        .alert {
            padding: 16px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-success { background: #e8f5e9; color: #2e7d32; border-left: 4px solid #4caf50; }
        .alert-error { background: #ffebee; color: #c62828; border-left: 4px solid #f44336; }
        .alert-info { background: #e3f2fd; color: #1565c0; border-left: 4px solid #2196f3; }

        /* ì±„ë„ ëª©ë¡ */
        .channel-list {
            display: grid;
            gap: 12px;
        }

        .channel-item {
            display: flex;
            align-items: center;
            padding: 16px;
            background: #f9f9f9;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .channel-item:hover {
            background: #e3f2fd;
        }

        .channel-item.selected {
            background: #e3f2fd;
            border: 2px solid #FF0000;
        }

        .channel-item img {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            margin-right: 16px;
        }

        .channel-item .info {
            flex: 1;
        }

        .channel-item .name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .channel-item .stats {
            font-size: 13px;
            color: #666;
        }

        /* ë³´ê³ ì„œ ë¯¸ë¦¬ë³´ê¸° */
        .report-preview {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            max-height: 600px;
            overflow-y: auto;
        }

        /* ë¸”ë¡œê·¸ ì—ë””í„° */
        .blog-preview {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 24px;
            min-height: 400px;
        }

        /* ê²½ìŸì‚¬ ì…ë ¥ */
        .competitor-inputs {
            display: grid;
            gap: 12px;
        }

        .competitor-input {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .competitor-input input {
            flex: 1;
        }

        /* ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ */
        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }

        /* ì¶”ì²œì‚¬í•­ */
        .recommendation {
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .recommendation.high { background: #ffebee; border-left: 4px solid #f44336; }
        .recommendation.medium { background: #fff3e0; border-left: 4px solid #ff9800; }
        .recommendation.low { background: #e3f2fd; border-left: 4px solid #2196f3; }

        .recommendation h4 {
            font-size: 14px;
            margin-bottom: 8px;
        }

        .recommendation ul {
            margin: 0;
            padding-left: 20px;
            font-size: 14px;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }

            .tab {
                width: 100%;
                text-align: center;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* ì¸í¬ê·¸ë˜í”½ ëŒ€ì‹œë³´ë“œ ìŠ¤íƒ€ì¼ */
        .infographic-section {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .infographic-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .infographic-title {
            font-size: 18px;
            font-weight: 700;
            color: #282828;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chart-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 24px;
            margin-bottom: 24px;
        }

        .chart-card {
            background: #f9f9f9;
            border-radius: 12px;
            padding: 20px;
            position: relative;
        }

        .chart-card h4 {
            font-size: 14px;
            font-weight: 600;
            color: #555;
            margin-bottom: 16px;
        }

        .chart-canvas-container {
            height: 220px;
            position: relative;
        }

        /* ë¹„ë””ì˜¤ ê·¸ë¦¬ë“œ ìŠ¤íƒ€ì¼ */
        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .video-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }

        .video-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
        }

        .video-thumbnail {
            width: 100%;
            aspect-ratio: 16/9;
            background: #e0e0e0;
            position: relative;
            overflow: hidden;
        }

        .video-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 700;
            color: white;
        }

        .video-badge.viral { background: linear-gradient(135deg, #FF0000, #cc0000); }
        .video-badge.hit { background: linear-gradient(135deg, #ff9800, #f57c00); }
        .video-badge.average { background: linear-gradient(135deg, #2196f3, #1976d2); }
        .video-badge.underperform { background: linear-gradient(135deg, #9e9e9e, #757575); }

        .video-duration {
            position: absolute;
            bottom: 8px;
            right: 8px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
        }

        .video-content {
            padding: 16px;
        }

        .video-title {
            font-size: 14px;
            font-weight: 600;
            color: #0f0f0f;
            line-height: 1.4;
            margin-bottom: 12px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .video-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .video-stat {
            text-align: center;
            padding: 8px;
            background: #f5f5f5;
            border-radius: 8px;
        }

        .video-stat-value {
            font-size: 16px;
            font-weight: 700;
            color: #FF0000;
        }

        .video-stat-label {
            font-size: 11px;
            color: #666;
            margin-top: 2px;
        }

        .video-score-bar {
            margin-top: 12px;
            background: #e0e0e0;
            border-radius: 4px;
            height: 6px;
            overflow: hidden;
        }

        .video-score-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        /* ë¶„ë¥˜ ì¹´ë“œ ê·¸ë¦¬ë“œ */
        .classification-cards {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .classification-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            border-top: 4px solid;
            position: relative;
            overflow: hidden;
        }

        .classification-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0.05;
            z-index: 0;
        }

        .classification-card.viral { border-color: #c62828; }
        .classification-card.viral::before { background: #c62828; }
        .classification-card.hit { border-color: #e65100; }
        .classification-card.hit::before { background: #e65100; }
        .classification-card.average { border-color: #1565c0; }
        .classification-card.average::before { background: #1565c0; }
        .classification-card.underperform { border-color: #616161; }
        .classification-card.underperform::before { background: #616161; }

        .classification-icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .classification-count {
            font-size: 36px;
            font-weight: 700;
            position: relative;
            z-index: 1;
        }

        .classification-card.viral .classification-count { color: #c62828; }
        .classification-card.hit .classification-count { color: #e65100; }
        .classification-card.average .classification-count { color: #1565c0; }
        .classification-card.underperform .classification-count { color: #616161; }

        .classification-label {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-top: 4px;
        }

        .classification-avg {
            font-size: 12px;
            color: #666;
            margin-top: 8px;
        }

        /* PDF ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ */
        .download-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .btn-pdf {
            background: linear-gradient(135deg, #FF0000, #cc0000);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: transform 0.2s;
        }

        .btn-pdf:hover {
            transform: scale(1.02);
            background: linear-gradient(135deg, #cc0000, #990000);
        }

        /* ì•Œê³ ë¦¬ì¦˜ ì ìˆ˜ ê²Œì´ì§€ */
        .algorithm-health {
            background: linear-gradient(135deg, #FF0000, #CC0000);
            color: white;
            padding: 32px;
            border-radius: 16px;
            text-align: center;
            margin-bottom: 24px;
        }

        .health-score {
            font-size: 64px;
            font-weight: 700;
        }

        .health-label {
            font-size: 18px;
            opacity: 0.9;
            margin-top: 8px;
        }

        .health-metrics {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 24px;
        }

        .health-metric {
            text-align: center;
        }

        .health-metric-value {
            font-size: 24px;
            font-weight: 700;
        }

        .health-metric-label {
            font-size: 13px;
            opacity: 0.8;
        }

        @media (max-width: 768px) {
            .chart-grid {
                grid-template-columns: 1fr;
            }
            .classification-cards {
                grid-template-columns: repeat(2, 1fr);
            }
            .video-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <div class="header">
            <h1><span style="background:#FF0000;color:white;padding:4px 8px;border-radius:4px;margin-right:8px;">â–¶</span>YouTube Analytics Dashboard</h1>
            <p>ì±„ë„ ë¶„ì„ / ê²½ìŸì‚¬ ë¹„êµ / ë¸”ë¡œê·¸ ìë™ìƒì„±</p>
        </div>

        <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="tabs">
            <button class="tab active" onclick="showTab('settings', this)">API ì„¤ì •</button>
            <button class="tab" onclick="showTab('channels', this)">ì±„ë„ ê´€ë¦¬</button>
            <button class="tab" onclick="showTab('analysis', this)">ì±„ë„ ë¶„ì„</button>
            <button class="tab" onclick="showTab('competitors', this)">ê²½ìŸì‚¬ ë¶„ì„</button>
            <button class="tab" onclick="showTab('blog', this)">ë¸”ë¡œê·¸ ìƒì„±</button>
        </div>

        <!-- API ì„¤ì • íƒ­ -->
        <div id="tab-settings" class="tab-content active">
            <div class="card">
                <div class="card-title">ğŸ”‘ API í‚¤ ì„¤ì •</div>
                <div class="form-group">
                    <label>YouTube Data API Key</label>
                    <input type="password" id="youtube-api-key" placeholder="YouTube API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                    <small style="color: #666; margin-top: 4px; display: block;">
                        <a href="https://console.cloud.google.com/apis/credentials" target="_blank">Google Cloud Console</a>ì—ì„œ API í‚¤ë¥¼ ë°œê¸‰ë°›ìœ¼ì„¸ìš”.
                    </small>
                </div>
                <div class="form-group">
                    <label>Gemini API Key (ë¸”ë¡œê·¸ ìƒì„±ìš©)</label>
                    <input type="password" id="gemini-api-key" placeholder="Gemini API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                    <small style="color: #666; margin-top: 4px; display: block;">
                        <a href="https://makersuite.google.com/app/apikey" target="_blank">Google AI Studio</a>ì—ì„œ API í‚¤ë¥¼ ë°œê¸‰ë°›ìœ¼ì„¸ìš”.
                    </small>
                </div>
                <button class="btn btn-primary" onclick="saveApiKeys()">ì €ì¥</button>
                <div id="api-status" style="margin-top: 16px;"></div>
            </div>
        </div>

        <!-- ì±„ë„ ê´€ë¦¬ íƒ­ -->
        <div id="tab-channels" class="tab-content">
            <div class="card">
                <div class="card-title">â• ì±„ë„ ì¶”ê°€</div>
                <div class="form-group">
                    <label>YouTube ì±„ë„ URL ë˜ëŠ” @handle</label>
                    <input type="text" id="channel-url" placeholder="ì˜ˆ: https://youtube.com/@channelname ë˜ëŠ” @channelname">
                </div>
                <button class="btn btn-primary" onclick="addChannel()">ì±„ë„ ì¶”ê°€</button>
            </div>

            <div class="card">
                <div class="card-title">ğŸ“‹ ì €ì¥ëœ ì±„ë„ ëª©ë¡</div>
                <div id="channel-list" class="channel-list">
                    <p style="color: #666; text-align: center; padding: 20px;">ì €ì¥ëœ ì±„ë„ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                </div>
            </div>
        </div>

        <!-- ì±„ë„ ë¶„ì„ íƒ­ -->
        <div id="tab-analysis" class="tab-content">
            <div class="card">
                <div class="card-title">ğŸ“Š ì±„ë„ ë¶„ì„ ì„¤ì •</div>
                <div class="form-group">
                    <label>ë¶„ì„í•  ì±„ë„ ì„ íƒ</label>
                    <select id="analysis-channel">
                        <option value="">ì±„ë„ì„ ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ë¶„ì„í•  ì˜ìƒ ìˆ˜</label>
                    <select id="video-count">
                        <option value="20">ìµœê·¼ 20ê°œ</option>
                        <option value="50" selected>ìµœê·¼ 50ê°œ</option>
                        <option value="100">ìµœê·¼ 100ê°œ</option>
                        <option value="200">ìµœê·¼ 200ê°œ</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="startAnalysis()">ë¶„ì„ ì‹œì‘</button>
            </div>

            <div id="analysis-loading" class="loading">
                <div class="spinner"></div>
                <p>ì±„ë„ì„ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤... (1-2ë¶„ ì†Œìš”)</p>
            </div>

            <div id="analysis-result" style="display: none;">
                <!-- ë¶„ì„ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- ê²½ìŸì‚¬ ë¶„ì„ íƒ­ -->
        <div id="tab-competitors" class="tab-content">
            <div class="card">
                <div class="card-title">ğŸ† ê²½ìŸì‚¬ ë¹„êµ ë¶„ì„</div>
                <div class="form-group">
                    <label>ë‚´ ì±„ë„</label>
                    <select id="main-channel">
                        <option value="">ì±„ë„ì„ ì„ íƒí•˜ì„¸ìš”</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ê²½ìŸ ì±„ë„ (ìµœëŒ€ 5ê°œ)</label>
                    <div id="competitor-inputs" class="competitor-inputs">
                        <div class="competitor-input">
                            <input type="text" placeholder="ê²½ìŸ ì±„ë„ URL ë˜ëŠ” @handle">
                            <button class="btn btn-secondary" onclick="addCompetitorInput()">+</button>
                        </div>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="startCompetitorAnalysis()">ë¹„êµ ë¶„ì„ ì‹œì‘</button>
            </div>

            <div id="competitor-loading" class="loading">
                <div class="spinner"></div>
                <p>ê²½ìŸì‚¬ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
            </div>

            <div id="competitor-result" style="display: none;">
                <!-- ê²½ìŸì‚¬ ë¶„ì„ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- ë¸”ë¡œê·¸ ìƒì„± íƒ­ -->
        <div id="tab-blog" class="tab-content">
            <div class="card">
                <div class="card-title">âœï¸ ë¸”ë¡œê·¸ ìë™ ìƒì„±</div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <div class="form-group">
                            <label>ì±„ë„ ì„ íƒ</label>
                            <select id="blog-channel" onchange="loadChannelVideos()">
                                <option value="">ì±„ë„ì„ ì„ íƒí•˜ì„¸ìš”</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ì˜ìƒ ì„ íƒ (ì„ íƒì‚¬í•­)</label>
                            <select id="blog-video">
                                <option value="">ì „ì²´ ì±„ë„ ë¶„ì„ ê¸°ë°˜</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ë¸”ë¡œê·¸ ì£¼ì œ (ì„ íƒì‚¬í•­)</label>
                            <input type="text" id="blog-topic" placeholder="ì˜ˆ: ìœ íŠœë¸Œ ì„±ì¥ ì „ëµ">
                        </div>
                    </div>
                    <div>
                        <div class="form-group">
                            <label>í”Œë«í¼</label>
                            <select id="blog-platform">
                                <option value="naver">ë„¤ì´ë²„ ë¸”ë¡œê·¸</option>
                                <option value="google">êµ¬ê¸€ ë¸”ë¡œê±°/ì›Œë“œí”„ë ˆìŠ¤</option>
                                <option value="tistory">í‹°ìŠ¤í† ë¦¬</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>í…Œë§ˆ</label>
                            <select id="blog-theme">
                                <option value="blue-gray">ë¸”ë£¨-ê·¸ë ˆì´ (ì°¨ë¶„/ì „ë¬¸ì )</option>
                                <option value="green-orange">ê·¸ë¦°-ì˜¤ë Œì§€ (í™œê¸°/ì¹œê·¼)</option>
                                <option value="purple-yellow">í¼í”Œ-ì˜ë¡œìš° (ì„¸ë ¨/ì°½ì˜ì )</option>
                                <option value="teal-gray">í‹¸-ë¼ì´íŠ¸ê·¸ë ˆì´ (ì•ˆì •/í˜„ëŒ€ì )</option>
                                <option value="terracotta">í…Œë¼ì½”íƒ€ (ë”°ëœ»/í¸ì•ˆ)</option>
                            </select>
                        </div>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="generateBlog()">ë¸”ë¡œê·¸ ìƒì„±</button>
            </div>

            <div id="blog-loading" class="loading">
                <div class="spinner"></div>
                <p>ë¸”ë¡œê·¸ ê¸€ì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
            </div>

            <div id="blog-result" style="display: none;">
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <div class="card-title" style="margin: 0;">ğŸ“ ìƒì„±ëœ ë¸”ë¡œê·¸</div>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-success" onclick="copyBlog()">ë³µì‚¬</button>
                            <button class="btn btn-secondary" onclick="downloadBlog()">ë‹¤ìš´ë¡œë“œ</button>
                        </div>
                    </div>
                    <div id="blog-title" style="font-size: 18px; font-weight: 600; margin-bottom: 8px;"></div>
                    <div id="blog-keywords" style="margin-bottom: 16px;"></div>
                    <div id="blog-preview" class="blog-preview"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API ê¸°ë³¸ URL (ìƒëŒ€ ê²½ë¡œ ì‚¬ìš© - ë¡œì»¬/Vercel ëª¨ë‘ í˜¸í™˜)
        const API_BASE = '';

        // ì €ì¥ëœ ë°ì´í„°
        let savedChannels = [];
        let currentAnalysis = null;
        let currentBlogContent = null;

        // íƒ­ ì „í™˜
        function showTab(tabName, clickedTab) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));

            document.getElementById('tab-' + tabName).classList.add('active');
            if (clickedTab) {
                clickedTab.classList.add('active');
            }

            // íƒ­ë³„ ì´ˆê¸°í™”
            if (tabName === 'channels') {
                loadChannels();
            } else if (tabName === 'analysis' || tabName === 'competitors' || tabName === 'report' || tabName === 'blog') {
                updateChannelSelects();
            }
        }

        // API í‚¤ ì €ì¥
        function saveApiKeys() {
            const youtubeKey = document.getElementById('youtube-api-key').value;
            const geminiKey = document.getElementById('gemini-api-key').value;

            localStorage.setItem('youtube_api_key', youtubeKey);
            localStorage.setItem('gemini_api_key', geminiKey);

            document.getElementById('api-status').innerHTML =
                '<div class="alert alert-success">API í‚¤ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.</div>';
        }

        // API í‚¤ ë¡œë“œ
        function loadApiKeys() {
            const youtubeKey = localStorage.getItem('youtube_api_key') || '';
            const geminiKey = localStorage.getItem('gemini_api_key') || '';

            document.getElementById('youtube-api-key').value = youtubeKey;
            document.getElementById('gemini-api-key').value = geminiKey;
        }

        // ì±„ë„ ì¶”ê°€
        async function addChannel() {
            const url = document.getElementById('channel-url').value.trim();
            const apiKey = localStorage.getItem('youtube_api_key');

            if (!url) {
                alert('ì±„ë„ URLì„ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            if (!apiKey) {
                alert('ë¨¼ì € YouTube API í‚¤ë¥¼ ì„¤ì •í•˜ì„¸ìš”.');
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/api/channels/add`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        channel_url: url,
                        youtube_api_key: apiKey
                    })
                });

                const data = await response.json();

                if (data.success) {
                    alert(data.message);
                    document.getElementById('channel-url').value = '';
                    loadChannels();
                } else {
                    alert('ì˜¤ë¥˜: ' + (data.detail || 'ì±„ë„ ì¶”ê°€ ì‹¤íŒ¨'));
                }
            } catch (error) {
                alert('ì„œë²„ ì—°ê²° ì˜¤ë¥˜: ' + error.message);
            }
        }

        // ì±„ë„ ëª©ë¡ ë¡œë“œ
        async function loadChannels() {
            try {
                const response = await fetch(`${API_BASE}/api/channels`);
                const data = await response.json();
                savedChannels = data.channels || [];
                renderChannelList();
                updateChannelSelects();
            } catch (error) {
                console.error('ì±„ë„ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // ì±„ë„ ëª©ë¡ ë Œë”ë§
        function renderChannelList() {
            const container = document.getElementById('channel-list');

            if (savedChannels.length === 0) {
                container.innerHTML = '<p style="color: #666; text-align: center; padding: 20px;">ì €ì¥ëœ ì±„ë„ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            container.innerHTML = savedChannels.map(ch => `
                <div class="channel-item" onclick="selectChannel('${ch.channel_id}')">
                    <img src="${ch.thumbnail_url || 'https://via.placeholder.com/48'}" alt="${ch.channel_name}">
                    <div class="info">
                        <div class="name">${ch.channel_name || 'ì•Œ ìˆ˜ ì—†ìŒ'}</div>
                        <div class="stats">êµ¬ë…ì ${formatNumber(ch.subscriber_count)} Â· ì˜ìƒ ${ch.video_count}ê°œ</div>
                    </div>
                </div>
            `).join('');
        }

        // ì±„ë„ ì„ íƒ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
        function updateChannelSelects() {
            const selects = ['analysis-channel', 'main-channel', 'report-channel', 'blog-channel'];
            const options = savedChannels.map(ch =>
                `<option value="${ch.channel_id}">${ch.channel_name}</option>`
            ).join('');

            selects.forEach(id => {
                const select = document.getElementById(id);
                if (select) {
                    select.innerHTML = '<option value="">ì±„ë„ì„ ì„ íƒí•˜ì„¸ìš”</option>' + options;
                }
            });
        }

        // ì±„ë„ ë¶„ì„ ì‹œì‘
        async function startAnalysis() {
            const channelId = document.getElementById('analysis-channel').value;
            const videoCount = document.getElementById('video-count').value;
            const apiKey = localStorage.getItem('youtube_api_key');

            if (!channelId) {
                alert('ì±„ë„ì„ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            if (!apiKey) {
                alert('YouTube API í‚¤ë¥¼ ì„¤ì •í•˜ì„¸ìš”.');
                return;
            }

            const channel = savedChannels.find(c => c.channel_id === channelId);

            document.getElementById('analysis-loading').classList.add('active');
            document.getElementById('analysis-result').style.display = 'none';

            try {
                const response = await fetch(`${API_BASE}/api/analyze`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        channel_url: channelId,
                        youtube_api_key: apiKey,
                        video_count: parseInt(videoCount)
                    })
                });

                const data = await response.json();

                if (data.success) {
                    currentAnalysis = data;
                    renderAnalysisResult(data);
                } else {
                    alert('ë¶„ì„ ì‹¤íŒ¨: ' + (data.detail || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                alert('ì„œë²„ ì˜¤ë¥˜: ' + error.message);
            } finally {
                document.getElementById('analysis-loading').classList.remove('active');
            }
        }

        // ë¶„ì„ ê²°ê³¼ ë Œë”ë§ (ì¸í¬ê·¸ë˜í”½ ë²„ì „)
        function renderAnalysisResult(data) {
            const analysis = data.analysis;
            const summary = analysis.channel_summary || {};
            const classification = analysis.classification_stats || {};
            const success = analysis.success_analysis || {};
            const failure = analysis.failure_analysis || {};
            const recommendations = analysis.recommendations || [];
            const growth = analysis.growth_trends || {};
            const algorithmInsights = analysis.algorithm_insights || {};

            const container = document.getElementById('analysis-result');
            container.style.display = 'block';

            // ëª¨ë“  ë¹„ë””ì˜¤ ìˆ˜ì§‘
            const allVideos = [];
            ['viral', 'hit', 'average', 'underperform'].forEach(cls => {
                if (classification[cls]?.videos) {
                    classification[cls].videos.forEach(v => {
                        v.classification = cls;
                        allVideos.push(v);
                    });
                }
            });
            allVideos.sort((a, b) => (b.algorithm_score || 0) - (a.algorithm_score || 0));

            // ê±´ê°•ë„ ê³„ì‚°
            const healthStatus = algorithmInsights.overall_health || 'ë¶„ì„ ì¤‘';
            const avgEngagement = summary.avg_engagement_rate || 0;
            const avgVelocity = summary.avg_view_velocity || 0;

            container.innerHTML = `
                <!-- ì•Œê³ ë¦¬ì¦˜ ê±´ê°•ë„ -->
                <div class="algorithm-health">
                    <div class="health-label">YouTube ì•Œê³ ë¦¬ì¦˜ ê±´ê°•ë„</div>
                    <div class="health-score">${healthStatus}</div>
                    <div class="health-metrics">
                        <div class="health-metric">
                            <div class="health-metric-value">${avgEngagement.toFixed(2)}%</div>
                            <div class="health-metric-label">í‰ê·  ì°¸ì—¬ìœ¨</div>
                        </div>
                        <div class="health-metric">
                            <div class="health-metric-value">${formatNumber(summary.avg_views_per_video)}</div>
                            <div class="health-metric-label">í‰ê·  ì¡°íšŒìˆ˜</div>
                        </div>
                        <div class="health-metric">
                            <div class="health-metric-value">${avgVelocity.toFixed(0)}/ì¼</div>
                            <div class="health-metric-label">ì¡°íšŒ ì†ë„</div>
                        </div>
                    </div>
                </div>

                <!-- ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ -->
                <div class="infographic-section">
                    <div class="infographic-header">
                        <div class="infographic-title">ğŸ“Š ${summary.channel_name || 'ì±„ë„'} ë¶„ì„ ë³´ê³ ì„œ</div>
                        <div class="download-buttons">
                            <button class="btn btn-primary" onclick="downloadAnalysisPPTX()" style="background:#FF6D00;">
                                ğŸ“Š PPT (ì¶”ì²œ)
                            </button>
                            <button class="btn btn-pdf" onclick="downloadAnalysisPDF()">
                                ğŸ“„ PDF
                            </button>
                            <button class="btn btn-secondary" onclick="downloadAnalysisHTML()">
                                ğŸŒ HTML
                            </button>
                            <button class="btn btn-secondary" onclick="downloadAnalysisJSON()">
                                ğŸ“‹ JSON
                            </button>
                        </div>
                    </div>

                    <!-- í•µì‹¬ ì§€í‘œ -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="icon">ğŸ‘¥</div>
                            <div class="value">${formatNumber(summary.subscriber_count)}</div>
                            <div class="label">êµ¬ë…ì</div>
                        </div>
                        <div class="stat-card">
                            <div class="icon">ğŸ¬</div>
                            <div class="value">${summary.total_videos_analyzed || 0}</div>
                            <div class="label">ë¶„ì„ ì˜ìƒ</div>
                        </div>
                        <div class="stat-card">
                            <div class="icon">ğŸ‘€</div>
                            <div class="value">${formatNumber(summary.avg_views_per_video)}</div>
                            <div class="label">í‰ê·  ì¡°íšŒìˆ˜</div>
                        </div>
                        <div class="stat-card">
                            <div class="icon">ğŸ’¬</div>
                            <div class="value">${avgEngagement.toFixed(2)}%</div>
                            <div class="label">í‰ê·  ì°¸ì—¬ìœ¨</div>
                        </div>
                        <div class="stat-card">
                            <div class="icon">â¤ï¸</div>
                            <div class="value">${(summary.avg_like_ratio || 0).toFixed(2)}%</div>
                            <div class="label">ì¢‹ì•„ìš” ë¹„ìœ¨</div>
                        </div>
                    </div>
                </div>

                <!-- ì˜ìƒ ë¶„ë¥˜ ì¹´ë“œ -->
                <div class="infographic-section">
                    <div class="infographic-title">ğŸ† ì˜ìƒ ì„±ê³¼ ë¶„ë¥˜</div>
                    <div class="classification-cards">
                        <div class="classification-card viral">
                            <div class="classification-icon">ğŸ”¥</div>
                            <div class="classification-count">${classification.viral?.count || 0}</div>
                            <div class="classification-label">ë°”ì´ëŸ´</div>
                            <div class="classification-avg">í‰ê·  ${formatNumber(classification.viral?.avg_views || 0)} ì¡°íšŒ</div>
                        </div>
                        <div class="classification-card hit">
                            <div class="classification-icon">â­</div>
                            <div class="classification-count">${classification.hit?.count || 0}</div>
                            <div class="classification-label">íˆíŠ¸</div>
                            <div class="classification-avg">í‰ê·  ${formatNumber(classification.hit?.avg_views || 0)} ì¡°íšŒ</div>
                        </div>
                        <div class="classification-card average">
                            <div class="classification-icon">ğŸ“Š</div>
                            <div class="classification-count">${classification.average?.count || 0}</div>
                            <div class="classification-label">í‰ê· </div>
                            <div class="classification-avg">í‰ê·  ${formatNumber(classification.average?.avg_views || 0)} ì¡°íšŒ</div>
                        </div>
                        <div class="classification-card underperform">
                            <div class="classification-icon">ğŸ“‰</div>
                            <div class="classification-count">${classification.underperform?.count || 0}</div>
                            <div class="classification-label">ì €ì¡°</div>
                            <div class="classification-avg">í‰ê·  ${formatNumber(classification.underperform?.avg_views || 0)} ì¡°íšŒ</div>
                        </div>
                    </div>

                    <!-- ì°¨íŠ¸ ì˜ì—­ -->
                    <div class="chart-grid">
                        <div class="chart-card">
                            <h4>ğŸ“Š ì„±ê³¼ ë¶„í¬</h4>
                            <div class="chart-canvas-container">
                                <canvas id="classificationPieChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-card">
                            <h4>ğŸ“ˆ ì•Œê³ ë¦¬ì¦˜ ì ìˆ˜ ë¶„í¬</h4>
                            <div class="chart-canvas-container">
                                <canvas id="scoreBarChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ì„±ê³µ/ì‹¤íŒ¨ íŒ¨í„´ -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="infographic-section" style="background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); margin-bottom: 0;">
                        <div class="infographic-title" style="color: #2e7d32;">âœ… ì„±ê³µ íŒ¨í„´</div>
                        ${success.success_patterns?.length ? `
                            <ul style="padding-left: 20px; margin: 0;">
                                ${success.success_patterns.slice(0, 5).map(p => `<li style="margin-bottom: 8px;">${p}</li>`).join('')}
                            </ul>
                        ` : '<p style="color: #666;">ë¶„ì„ ì¤‘...</p>'}
                    </div>
                    <div class="infographic-section" style="background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%); margin-bottom: 0;">
                        <div class="infographic-title" style="color: #c62828;">âš ï¸ ê°œì„  í•„ìš”</div>
                        ${failure.failure_patterns?.length ? `
                            <ul style="padding-left: 20px; margin: 0;">
                                ${failure.failure_patterns.slice(0, 5).map(p => `<li style="margin-bottom: 8px;">${p}</li>`).join('')}
                            </ul>
                        ` : '<p style="color: #666;">ê°œì„  ì‚¬í•­ ì—†ìŒ</p>'}
                    </div>
                </div>

                <!-- ì¶”ì²œ ì „ëµ -->
                <div class="infographic-section">
                    <div class="infographic-title">ğŸ’¡ ë°ì´í„° ê¸°ë°˜ ì¶”ì²œ ì „ëµ</div>
                    ${recommendations.map(rec => `
                        <div class="recommendation ${rec.priority || 'medium'}">
                            <h4>${rec.priority === 'critical' || rec.priority === 'high' ? 'ğŸ”´' : rec.priority === 'medium' ? 'ğŸŸ¡' : 'ğŸ”µ'} ${rec.category || ''}</h4>
                            ${rec.current && rec.target ? `<p style="font-size:13px;color:#666;margin-bottom:8px;">í˜„ì¬: ${rec.current} â†’ ëª©í‘œ: ${rec.target}</p>` : ''}
                            <ul>
                                ${(rec.suggestions || []).map(s => `<li>${s}</li>`).join('')}
                            </ul>
                        </div>
                    `).join('')}
                </div>

                <!-- ì˜ìƒ ê·¸ë¦¬ë“œ -->
                <div class="infographic-section">
                    <div class="infographic-header">
                        <div class="infographic-title">ğŸ¬ ì „ì²´ ì˜ìƒ ì„±ê³¼ (Grid View)</div>
                        <select id="videoFilter" onchange="filterVideos()" style="padding: 8px 16px; border-radius: 8px; border: 2px solid #e0e0e0;">
                            <option value="all">ì „ì²´ ë³´ê¸°</option>
                            <option value="viral">ğŸ”¥ ë°”ì´ëŸ´ë§Œ</option>
                            <option value="hit">â­ íˆíŠ¸ë§Œ</option>
                            <option value="average">ğŸ“Š í‰ê· ë§Œ</option>
                            <option value="underperform">ğŸ“‰ ì €ì¡°ë§Œ</option>
                        </select>
                    </div>
                    <div class="video-grid" id="videoGrid">
                        ${allVideos.slice(0, 20).map(v => renderVideoCard(v)).join('')}
                    </div>
                    ${allVideos.length > 20 ? `
                        <div style="text-align: center; margin-top: 20px;">
                            <button class="btn btn-secondary" onclick="loadMoreVideos()">ë” ë³´ê¸° (${allVideos.length - 20}ê°œ ë”)</button>
                        </div>
                    ` : ''}
                </div>
            `;

            // ì°¨íŠ¸ ìƒì„±
            createAnalysisCharts(classification, allVideos);

            // ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
            window.analysisAllVideos = allVideos;
            window.currentAnalysis = data;
        }

        // ë¹„ë””ì˜¤ ì¹´ë“œ ë Œë”ë§
        function renderVideoCard(v) {
            const scoreColor = v.classification === 'viral' ? '#c62828' :
                             v.classification === 'hit' ? '#e65100' :
                             v.classification === 'average' ? '#1565c0' : '#616161';
            const scorePercent = Math.min(100, (v.algorithm_score || 0));

            return `
                <div class="video-card" data-classification="${v.classification}" onclick="window.open('https://youtube.com/watch?v=${v.video_id}', '_blank')">
                    <div class="video-thumbnail">
                        <img src="${v.thumbnail_url || `https://img.youtube.com/vi/${v.video_id}/mqdefault.jpg`}" alt="${v.title || ''}" onerror="this.src='https://via.placeholder.com/320x180?text=No+Thumbnail'">
                        <span class="video-badge ${v.classification}">${getClassificationLabel(v.classification)}</span>
                    </div>
                    <div class="video-content">
                        <div class="video-title">${v.title || 'ì œëª© ì—†ìŒ'}</div>
                        <div class="video-stats">
                            <div class="video-stat">
                                <div class="video-stat-value">${formatNumber(v.view_count)}</div>
                                <div class="video-stat-label">ì¡°íšŒìˆ˜</div>
                            </div>
                            <div class="video-stat">
                                <div class="video-stat-value">${(v.engagement_rate || 0).toFixed(2)}%</div>
                                <div class="video-stat-label">ì°¸ì—¬ìœ¨</div>
                            </div>
                            <div class="video-stat">
                                <div class="video-stat-value">${(v.view_velocity || 0).toFixed(0)}/ì¼</div>
                                <div class="video-stat-label">ì¡°íšŒì†ë„</div>
                            </div>
                            <div class="video-stat">
                                <div class="video-stat-value">${(v.like_ratio || 0).toFixed(2)}%</div>
                                <div class="video-stat-label">ì¢‹ì•„ìš”ìœ¨</div>
                            </div>
                        </div>
                        <div class="video-score-bar">
                            <div class="video-score-fill" style="width: ${scorePercent}%; background: ${scoreColor};"></div>
                        </div>
                        <div style="text-align: center; margin-top: 8px; font-size: 12px; color: ${scoreColor}; font-weight: 600;">
                            ì•Œê³ ë¦¬ì¦˜ ì ìˆ˜: ${(v.algorithm_score || 0).toFixed(0)}
                        </div>
                    </div>
                </div>
            `;
        }

        // ì°¨íŠ¸ ìƒì„±
        function createAnalysisCharts(classification, allVideos) {
            // íŒŒì´ ì°¨íŠ¸
            const pieCtx = document.getElementById('classificationPieChart');
            if (pieCtx) {
                new Chart(pieCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['ë°”ì´ëŸ´', 'íˆíŠ¸', 'í‰ê· ', 'ì €ì¡°'],
                        datasets: [{
                            data: [
                                classification.viral?.count || 0,
                                classification.hit?.count || 0,
                                classification.average?.count || 0,
                                classification.underperform?.count || 0
                            ],
                            backgroundColor: ['#c62828', '#e65100', '#1565c0', '#616161'],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'right', labels: { font: { size: 12 }, padding: 12 } }
                        },
                        cutout: '55%'
                    }
                });
            }

            // ì ìˆ˜ ë¶„í¬ ë°” ì°¨íŠ¸
            const barCtx = document.getElementById('scoreBarChart');
            if (barCtx) {
                const scoreRanges = { '0-20': 0, '21-40': 0, '41-60': 0, '61-80': 0, '81-100': 0 };
                allVideos.forEach(v => {
                    const score = v.algorithm_score || 0;
                    if (score <= 20) scoreRanges['0-20']++;
                    else if (score <= 40) scoreRanges['21-40']++;
                    else if (score <= 60) scoreRanges['41-60']++;
                    else if (score <= 80) scoreRanges['61-80']++;
                    else scoreRanges['81-100']++;
                });

                new Chart(barCtx, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(scoreRanges),
                        datasets: [{
                            label: 'ì˜ìƒ ìˆ˜',
                            data: Object.values(scoreRanges),
                            backgroundColor: ['#616161', '#9e9e9e', '#1565c0', '#e65100', '#c62828'],
                            borderRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { beginAtZero: true, grid: { display: false } },
                            x: { grid: { display: false } }
                        }
                    }
                });
            }
        }

        // ë¹„ë””ì˜¤ í•„í„°ë§
        function filterVideos() {
            const filter = document.getElementById('videoFilter').value;
            const videos = window.analysisAllVideos || [];
            const filtered = filter === 'all' ? videos : videos.filter(v => v.classification === filter);

            document.getElementById('videoGrid').innerHTML = filtered.slice(0, 20).map(v => renderVideoCard(v)).join('');
        }

        // PPT ë‹¤ìš´ë¡œë“œ (í•œê¸€ ì™„ë²½ ì§€ì›)
        function downloadAnalysisPPTX() {
            const data = window.currentAnalysis;
            if (!data) { alert('ë¶„ì„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'); return; }

            const channelId = data.channel_id;
            window.open(`${API_BASE}/api/analyze/${channelId}/report?format=pptx`, '_blank');
        }

        // PDF ë‹¤ìš´ë¡œë“œ
        function downloadAnalysisPDF() {
            const data = window.currentAnalysis;
            if (!data) { alert('ë¶„ì„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'); return; }

            const channelId = data.channel_id;
            window.open(`${API_BASE}/api/analyze/${channelId}/report?format=pdf`, '_blank');
        }

        // HTML ë‹¤ìš´ë¡œë“œ
        function downloadAnalysisHTML() {
            const data = window.currentAnalysis;
            if (!data) { alert('ë¶„ì„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'); return; }

            const channelId = data.channel_id;
            window.open(`${API_BASE}/api/analyze/${channelId}/report?format=html`, '_blank');
        }

        // JSON ë‹¤ìš´ë¡œë“œ
        function downloadAnalysisJSON() {
            const data = window.currentAnalysis;
            if (!data) { alert('ë¶„ì„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.'); return; }

            const blob = new Blob([JSON.stringify(data.analysis, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `youtube_analysis_${data.channel_id}_${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // ë” ë³´ê¸° (ë¹„ë””ì˜¤ ë¡œë“œ)
        function loadMoreVideos() {
            const videos = window.analysisAllVideos || [];
            const grid = document.getElementById('videoGrid');
            const currentCount = grid.querySelectorAll('.video-card').length;
            const nextVideos = videos.slice(currentCount, currentCount + 20);

            if (nextVideos.length > 0) {
                grid.innerHTML += nextVideos.map(v => renderVideoCard(v)).join('');
            }

            // ë” ì´ìƒ ë¡œë“œí•  ë¹„ë””ì˜¤ê°€ ì—†ìœ¼ë©´ ë²„íŠ¼ ìˆ¨ê¸°ê¸°
            if (currentCount + nextVideos.length >= videos.length) {
                event.target.parentElement.style.display = 'none';
            } else {
                // ë‚¨ì€ ê°œìˆ˜ ì—…ë°ì´íŠ¸
                const remaining = videos.length - currentCount - nextVideos.length;
                event.target.textContent = `ë” ë³´ê¸° (${remaining}ê°œ ë”)`;
            }
        }

        // ê²½ìŸì‚¬ ì…ë ¥ ì¶”ê°€
        function addCompetitorInput() {
            const container = document.getElementById('competitor-inputs');
            if (container.children.length >= 5) {
                alert('ìµœëŒ€ 5ê°œê¹Œì§€ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return;
            }

            const div = document.createElement('div');
            div.className = 'competitor-input';
            div.innerHTML = `
                <input type="text" placeholder="ê²½ìŸ ì±„ë„ URL ë˜ëŠ” @handle">
                <button class="btn btn-danger" onclick="this.parentElement.remove()">-</button>
            `;
            container.appendChild(div);
        }

        // ê²½ìŸì‚¬ ë¶„ì„ ì‹œì‘
        async function startCompetitorAnalysis() {
            const mainChannelId = document.getElementById('main-channel').value;
            const apiKey = localStorage.getItem('youtube_api_key');

            if (!mainChannelId) {
                alert('ë‚´ ì±„ë„ì„ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            if (!apiKey) {
                alert('YouTube API í‚¤ë¥¼ ì„¤ì •í•˜ì„¸ìš”.');
                return;
            }

            const competitorInputs = document.querySelectorAll('#competitor-inputs input');
            const competitorUrls = [];
            competitorInputs.forEach(input => {
                if (input.value.trim()) {
                    competitorUrls.push(input.value.trim());
                }
            });

            if (competitorUrls.length === 0) {
                alert('ìµœì†Œ 1ê°œì˜ ê²½ìŸ ì±„ë„ì„ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }

            document.getElementById('competitor-loading').classList.add('active');
            document.getElementById('competitor-result').style.display = 'none';

            try {
                const response = await fetch(`${API_BASE}/api/analyze/competitors`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        main_channel_url: mainChannelId,
                        competitor_urls: competitorUrls,
                        youtube_api_key: apiKey,
                        video_count: 30
                    })
                });

                const data = await response.json();

                if (data.success) {
                    renderCompetitorResult(data);
                } else {
                    alert('ë¶„ì„ ì‹¤íŒ¨: ' + (data.detail || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                alert('ì„œë²„ ì˜¤ë¥˜: ' + error.message);
            } finally {
                document.getElementById('competitor-loading').classList.remove('active');
            }
        }

        // ê²½ìŸì‚¬ ë¶„ì„ ê²°ê³¼ ë Œë”ë§
        function renderCompetitorResult(data) {
            const container = document.getElementById('competitor-result');
            container.style.display = 'block';

            // ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
            window.currentCompetitorAnalysis = data;

            container.innerHTML = `
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 12px;">
                        <div class="card-title" style="margin: 0;">ğŸ“Š ê²½ìŸì‚¬ ë¹„êµ ë³´ê³ ì„œ</div>
                        <div class="download-buttons">
                            <button class="btn btn-pdf" onclick="downloadCompetitorPDF()">
                                ğŸ“„ PDF ë‹¤ìš´ë¡œë“œ
                            </button>
                            <button class="btn btn-secondary" onclick="downloadCompetitorHTML()">
                                ğŸŒ HTML ë‹¤ìš´ë¡œë“œ
                            </button>
                            <button class="btn btn-secondary" onclick="downloadCompetitorJSON()">
                                ğŸ“‹ JSON ë‹¤ìš´ë¡œë“œ
                            </button>
                        </div>
                    </div>
                    ${data.html_report || '<p>ë³´ê³ ì„œ ìƒì„± ì¤‘...</p>'}
                </div>
            `;
        }

        // ê²½ìŸì‚¬ ë¶„ì„ PDF ë‹¤ìš´ë¡œë“œ
        function downloadCompetitorPDF() {
            const data = window.currentCompetitorAnalysis;
            if (!data || !data.main_channel_id) {
                alert('ë¶„ì„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ê²½ìŸì‚¬ ë¶„ì„ì„ ì‹¤í–‰í•˜ì„¸ìš”.');
                return;
            }
            window.open(`${API_BASE}/api/analyze/competitors/${data.main_channel_id}/report?format=pdf`, '_blank');
        }

        // ê²½ìŸì‚¬ ë¶„ì„ HTML ë‹¤ìš´ë¡œë“œ
        function downloadCompetitorHTML() {
            const data = window.currentCompetitorAnalysis;
            if (!data || !data.main_channel_id) {
                alert('ë¶„ì„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ê²½ìŸì‚¬ ë¶„ì„ì„ ì‹¤í–‰í•˜ì„¸ìš”.');
                return;
            }
            window.open(`${API_BASE}/api/analyze/competitors/${data.main_channel_id}/report?format=html`, '_blank');
        }

        // ê²½ìŸì‚¬ ë¶„ì„ JSON ë‹¤ìš´ë¡œë“œ
        function downloadCompetitorJSON() {
            const data = window.currentCompetitorAnalysis;
            if (!data) {
                alert('ë¶„ì„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ê²½ìŸì‚¬ ë¶„ì„ì„ ì‹¤í–‰í•˜ì„¸ìš”.');
                return;
            }

            const blob = new Blob([JSON.stringify(data.comparison, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `competitor_analysis_${data.main_channel_id || 'report'}_${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // ë³´ê³ ì„œ ë¡œë“œ
        async function loadReport() {
            const channelId = document.getElementById('report-channel').value;
            if (!channelId) return;

            try {
                const response = await fetch(`${API_BASE}/api/analyze/${channelId}/report?format=html`);
                if (response.ok) {
                    const html = await response.text();
                    document.getElementById('report-preview').style.display = 'block';
                    document.getElementById('report-preview').innerHTML = html;
                }
            } catch (error) {
                console.error('ë³´ê³ ì„œ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // ì±„ë„ ì˜ìƒ ë¡œë“œ
        async function loadChannelVideos() {
            const channelId = document.getElementById('blog-channel').value;
            const select = document.getElementById('blog-video');

            select.innerHTML = '<option value="">ì „ì²´ ì±„ë„ ë¶„ì„ ê¸°ë°˜</option>';

            if (!channelId) return;

            try {
                const response = await fetch(`${API_BASE}/api/videos/${channelId}?limit=20`);
                const data = await response.json();

                (data.videos || []).forEach(video => {
                    const option = document.createElement('option');
                    option.value = video.video_id;
                    option.textContent = video.title?.substring(0, 50) + '...';
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('ì˜ìƒ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // ë¸”ë¡œê·¸ ìƒì„±
        async function generateBlog() {
            const channelId = document.getElementById('blog-channel').value;
            const videoId = document.getElementById('blog-video').value;
            const topic = document.getElementById('blog-topic').value;
            const platform = document.getElementById('blog-platform').value;
            const theme = document.getElementById('blog-theme').value;
            const geminiKey = localStorage.getItem('gemini_api_key');

            if (!channelId) {
                alert('ì±„ë„ì„ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            if (!geminiKey) {
                alert('Gemini API í‚¤ë¥¼ ì„¤ì •í•˜ì„¸ìš”.');
                return;
            }

            document.getElementById('blog-loading').classList.add('active');
            document.getElementById('blog-result').style.display = 'none';

            try {
                const response = await fetch(`${API_BASE}/api/blog/generate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        channel_id: channelId,
                        video_id: videoId || null,
                        gemini_api_key: geminiKey,
                        platform: platform,
                        theme: theme,
                        topic: topic || null
                    })
                });

                const data = await response.json();

                if (data.success) {
                    currentBlogContent = data;
                    renderBlogResult(data);
                } else {
                    alert('ìƒì„± ì‹¤íŒ¨: ' + (data.detail || data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                alert('ì„œë²„ ì˜¤ë¥˜: ' + error.message);
            } finally {
                document.getElementById('blog-loading').classList.remove('active');
            }
        }

        // ë¸”ë¡œê·¸ ê²°ê³¼ ë Œë”ë§
        function renderBlogResult(data) {
            document.getElementById('blog-result').style.display = 'block';
            document.getElementById('blog-title').textContent = data.title || 'ì œëª© ì—†ìŒ';
            document.getElementById('blog-keywords').innerHTML =
                (data.keywords || []).map(k => `<span class="badge badge-average">${k}</span>`).join(' ');
            document.getElementById('blog-preview').innerHTML = data.content || '';
        }

        // ë¸”ë¡œê·¸ ë³µì‚¬
        function copyBlog() {
            if (!currentBlogContent) return;

            const content = currentBlogContent.content || '';
            navigator.clipboard.writeText(content).then(() => {
                alert('ë¸”ë¡œê·¸ HTMLì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
            });
        }

        // ë¸”ë¡œê·¸ ë‹¤ìš´ë¡œë“œ
        function downloadBlog() {
            if (!currentBlogContent) return;

            const content = currentBlogContent.content || '';
            const blob = new Blob([content], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `blog_${Date.now()}.html`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // ë³´ê³ ì„œ ë‹¤ìš´ë¡œë“œ
        function downloadReport(format) {
            const channelId = document.getElementById('report-channel').value;
            if (!channelId) {
                alert('ì±„ë„ì„ ì„ íƒí•˜ì„¸ìš”.');
                return;
            }

            window.open(`${API_BASE}/api/analyze/${channelId}/report?format=${format}`, '_blank');
        }

        // ë³´ê³ ì„œ ë³µì‚¬
        function copyReport() {
            const content = document.getElementById('report-preview').innerHTML;
            navigator.clipboard.writeText(content).then(() => {
                alert('ë³´ê³ ì„œê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
            });
        }

        // ìˆ«ì í¬ë§·íŒ…
        function formatNumber(num) {
            if (!num) return '0';
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return num.toString();
        }

        // ë¶„ë¥˜ ë¼ë²¨
        function getClassificationLabel(cls) {
            const labels = {
                viral: 'ğŸ”¥ ë°”ì´ëŸ´',
                hit: 'â­ íˆíŠ¸',
                average: 'ğŸ“Š í‰ê· ',
                underperform: 'ğŸ“‰ ë¶€ì§„'
            };
            return labels[cls] || cls;
        }

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            loadApiKeys();
            loadChannels();
        });
    </script>
</body>
</html>
